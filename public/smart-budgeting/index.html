<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/icons/site.webmanifest">
    <title>AturUang</title>

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Alexandria:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">

    <!-- jQuery -->
    <script src="/js/jquery-3.7.1.js"></script>

    <!-- AOS -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css">

    <!-- CSS -->
    <link rel="stylesheet" href="/css/style.css">
</head>

<body class="font-default font-light text-primary bg-secondary w-full no-scrollbar">
    <!-- navbar ðŸ§ -->
    <div id="navBar"></div>
    <!-- navbar end ðŸ§ -->

    <!-- main section ðŸ§-->
    <main>
        <section class="font-default w-full flex items-center justify-center gap-4 py-20 lg:py-30 bg-secondary">
            <div x-data="{tab: 'pembagianKeuangan'}"
                class="w-[90%] min-h-[70%] lg:w-[60%] lg:min-h-[50%] 2xl:min-w-0 items-center lg:items-stretch p-8 lg:p-17 gap-4 flex flex-col bg-white rounded-2xl mx-auto">
                <div class="flex w-full h-full flex-col gap-4 items-center lg:items-start">
                    <h1
                        class="text-primary text-center mb-5 lg:text-start text-4xl lg:text-[2.5rem] font-default font-semibold">
                        Smart Budgeting</h1>
                    <!-- tab -->
                    <div
                        class="flex space-x-4 w-full items-center lg:justify-start relative before:absolute before:-bottom-3 before:left-0 before:bg-primary before:opacity-20 before:w-full before:h-px">
                        <button @click="tab = 'pembagianKeuangan'"
                            class="text-sm lg:text-base hover:cursor-pointer hover:relative hover:before:absolute hover:before:-bottom-3 hover:before:left-0 hover:before:bg-primary hover:before:opacity-50 hover:before:w-full hover:before:h-px"
                            x-bind:class="{'font-semibold relative before:absolute before:-bottom-3 before:left-0 before:bg-primary before:w-full before:h-px': tab == 'pembagianKeuangan', 'font-normal': tab !== 'pembagianKeuangan'}">
                            Pembagian Keuangan
                        </button>
                        <button @click="tab = 'perbandinganPengeluaran'"
                            class="text-sm lg:text-base hover:cursor-pointer hover:relative hover:before:absolute hover:before:-bottom-3 hover:before:left-0 hover:before:bg-primary hover:before:opacity-50 hover:before:w-full hover:before:h-px"
                            x-bind:class="{'font-semibold relative before:absolute before:-bottom-3 before:left-0 before:bg-primary before:w-full before:h-px': tab == 'perbandinganPengeluaran', 'font-normal': tab !== 'perbandinganPengeluaran'}">
                            Perbandingan Pengeluaran
                        </button>
                    </div>
                    <!-- tab end -->
                </div>
                <div class="mt-5 w-full">
                    <!-- pembagian keuangan -->
                    <div class="flex flex-col lg:text-start" x-show="tab === 'pembagianKeuangan'">
                        <div class="flex flex-col w-full h-full items-center lg:items-start">
                            <h4 class="text-sm lg:text-base">Masukkan total anggaran bulananmu dan
                                lihat pembagian ideal 50 : 30 :
                                20! (input berupa Rupiah)</h4>
                            <div class="relative font-normal">
                                <h1 class="absolute left-5 top-1/2 -translate-y-1/10">Rp</h1>
                                <!-- <input type="number" min="1" step="any" id="inputPembagian"
                                class="border-primary border border-solid items-center py-3 pr-10 pl-11 rounded-[100px] mt-5 w-full outline-none"> -->
                                <input type="text" min="1" step="any" id="inputPembagian"
                                    class="border-primary border border-solid items-center py-3 pr-10 pl-11 rounded-[100px] mt-5 w-full outline-none">
                                <input type="hidden" id="realInputPembagian">
                            </div>
                            <button id="submitHitung"
                                class="btn-primary-hp mt-5 text-sm lg:text-base w-full lg:w-fit lg:btn-primary font-normal">Hitung
                                Pembagian</button>
                        </div>

                        <!-- hasil pembagian ideal -->
                        <div id="containerOutputPembagianIdeal" class="hidden flex-col mt-14">
                            <h1 class="text-center text-xl font-semibold">Hasil Pembagian Ideal</h1>

                            <div class="flex flex-col mt-4 w-full">
                                <div class="flex justify-between">
                                    <p>Kebutuhan Pokok:</p>
                                    <p>Rp<span id="outputKebutuhanPokok"></span></p>
                                </div>
                                <div class="flex justify-between">
                                    <p>Keinginan:</p>
                                    <p>Rp<span id="outputKeinginan"></span></p>
                                </div>
                                <div class="flex justify-between">
                                    <p>Tabungan/Investasi:</p>
                                    <p>Rp<span id="outputTabunganInvestasi"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- perbandingan keuangan end -->

                    <!-- perbandingan pengeluaran -->
                    <div class="flex flex-col justify-between" x-show="tab === 'perbandinganPengeluaran'">
                        <!-- input -->
                        <div class="flex flex-col gap-5 w-full">
                            <div class="flex flex-col gap-2.5 mb-5 lg:gap-[15px]">
                                <h1 class="font-bold-custom">Total Anggaran Bulanan</h1>
                                <div class="relative font-normal">
                                    <h1 class="absolute left-5 top-1/2 -translate-y-1/10">Rp</h1>
                                    <input type="text" min="1" step="any" id="inputTotalAnggaranBulanan"
                                        class="input-perbandingan border-primary border border-solid items-center py-3 pr-10 pl-11 rounded-[100px] mt-5 w-full outline-none">
                                    <input type="hidden" id="realInputTotalAnggaranBulanan">
                                </div>
                            </div>
                            <div class="flex flex-col gap-[15px]">
                                <h1 class="font-bold-custom">Rincian Pengeluaran</h1>
                                <div class="flex flex-col">
                                    <h1 class="font-normal">Kebutuhan Pokok</h1>
                                    <div class="relative font-normal">
                                        <h1 class="absolute left-5 top-1/2 -translate-y-1/10">Rp</h1>
                                        <input type="text" min="1" step="any" id="inputKebutuhanPokok"
                                            class="input-perbandingan border-primary border border-solid items-center py-3 pr-10 pl-11 rounded-[100px] mt-5 w-full outline-none">
                                        <input type="hidden" id="realInputKebutuhanPokok">
                                    </div>
                                </div>
                                <div class="flex flex-col">
                                    <h1 class="font-normal">Keinginan</h1>
                                    <div class="relative font-normal">
                                        <h1 class="absolute left-5 top-1/2 -translate-y-1/10">Rp</h1>
                                        <input type="text" min="1" step="any" id="inputKeinginan"
                                            class="input-perbandingan border-primary border border-solid items-center py-3 pr-10 pl-11 rounded-[100px] mt-5 w-full outline-none">
                                        <input type="hidden" id="realInputKeinginan">
                                    </div>
                                </div>
                                <div class="flex flex-col">
                                    <h1 class="font-normal">Tabungan atau Investasi</h1>
                                    <div class="relative font-normal">
                                        <h1 class="absolute left-5 top-1/2 -translate-y-1/10">Rp</h1>
                                        <input type="text" min="1" step="any" id="inputTabunganAtauInvestasi"
                                            class="input-perbandingan border-primary border border-solid items-center py-3 pr-10 pl-11 rounded-[100px] mt-5 w-full outline-none">
                                        <input type="hidden" id="realInputTabunganAtauInvestasi">
                                    </div>
                                </div>
                            </div>
                            <button id="submit"
                                class="btn-primary-hp text-sm lg:text-base mt-5 sm:w-full lg:w-fit lg:btn-primary font-normal">Analisis
                                Perbandingan</button>
                        </div>
                        <!-- chart ðŸ§ -->
                        <div class="flex flex-col w-full">
                            <canvas id="chartOutput" class="w-full max-h-70 lg:max-h-80 mt-20 lg:mt-5 hidden"></canvas>
                            <!-- Rekomendasi Aksi -->
                            <div id="parentHasil" class="mt-5 hidden">
                                <h1 class="font-bold">Rekomendasi Aksi</h1>
                                <span id="hasil" class="font-light"></span>
                            </div>
                        </div>
                    </div>
                    <!-- perbandingan pengeluaran end -->

                </div>
            </div>
        </section>
    </main>
    <!-- main section end -->

    <script>
        // format input rupiah dengan jquery
        $(document).ready(function () {
            let $priceInput = $('#inputPembagian');
            let $hiddenPrice = $('#realInputPembagian');

            function formatRupiah(angka) {
                let reverse = angka.toString().split('').reverse().join('');
                let ribuan = reverse.match(/\d{1,3}/g);
                let formatted = ribuan.join('.').split('').reverse().join('');
                return formatted;
            }

            function cleanNumber(angka) {
                return angka.replace(/\./g, '');
            }

            $('.input-perbandingan').each(function () {
                let $priceInput = $(this);
                let $hiddenPrice = $(this).next('input[type="hidden"]');

                $priceInput.on('keyup', function () {
                    var rawValue = $(this).val();
                    var cleanedValue = cleanNumber(rawValue);

                    // Pastikan input adalah angka (atau string kosong)
                    if (cleanedValue === '') {
                        $hiddenPrice.val('');
                        $(this).val('');
                        return;
                    }

                    var formattedValue = formatRupiah(cleanedValue);
                    $(this).val(formattedValue);
                    $hiddenPrice.val(cleanedValue);
                });
            });

            // Event listener saat pengguna mengetik di priceInput
            $priceInput.on('keyup', function () {
                var rawValue = $(this).val();
                var cleanedValue = cleanNumber(rawValue);

                // Pastikan input adalah angka (atau string kosong)
                if (cleanedValue === '') {
                    $hiddenPrice.val('');
                    $(this).val('');
                    return;
                }

                var formattedValue = formatRupiah(cleanedValue);
                $(this).val(formattedValue);
                $hiddenPrice.val(cleanedValue);
            });
        });

        function perhitunganPembagianKeuangan() {
            let input = $('#realInputPembagian').val();

            if (input == 0 || isNaN(input)) {
                alert('Harap diisi terlebih dahulu dan jangan ada karakter yang selain angka');
                return;
            }
            // kebutuhan 50%
            let kebutuhan = input * 50 / 100;
            // keinginan 30%
            let keinginan = input * 30 / 100;
            // tabungan dan investasi 20%
            let tabunganDanInvestasi = input * 20 / 100;

            // format Rupiah
            kebutuhan = kebutuhan.toLocaleString('id-ID');
            keinginan = keinginan.toLocaleString('id-ID');
            tabunganDanInvestasi = tabunganDanInvestasi.toLocaleString('id-ID');

            $('#outputKebutuhanPokok').text(kebutuhan);
            $('#outputKeinginan').text(keinginan);
            $('#outputTabunganInvestasi').text(tabunganDanInvestasi);


            $('#containerOutputPembagianIdeal').removeClass("hidden").addClass("flex");
        }

        const submit = $('#submitHitung');
        submit.on('click', function () {
            return perhitunganPembagianKeuangan();
        });

        $('#inputPembagian').keypress(function (e) {
            if (e.which == 13) {
                return perhitunganPembagianKeuangan();
            }
        })
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.15.1/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        AOS.init();

        document.addEventListener('aos:in', ({ detail }) => {
            setTimeout(() => {
                detail.removeAttribute('data-aos');
                detail.removeAttribute('data-aos-duration');
                detail.classList.remove('aos-animate');
            }, 1100); // sedikit lebih lama dari durasi animasi
        });
    </script>
    <script>

        function generateChart(data1, data2) {
            const ctx = $('#chartOutput')[0].getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Kebutuhan Pokok', 'Keinginan', 'Tabungan/Investasi'],
                    datasets: [{
                        label: 'Pengeluaran',
                        data: data1,
                        backgroundColor: '#1E3A8A'
                    }, {
                        label: 'Pembagian anggaran dari sistem',
                        data: data2,
                        backgroundColor: '#25A3FD'
                    }
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointSyle: true
                            }
                        }
                    }
                }
            });

        }

        // generateChart([0, 0, 0], [0, 0, 0]);

        // Perbandingan Pengeluaran
        function perbandinganPengeluaran() {
            const existingChart = Chart.getChart("chartOutput");
            if (existingChart) existingChart.destroy();
            // Sebagai data asli input
            const dataKebutuhanPokok = $('#realInputKebutuhanPokok').val();
            const dataKeinginan = $('#realInputKeinginan').val();
            const dataTabunganAtauInvestasi = $('#realInputTabunganAtauInvestasi').val();

            if ((dataKebutuhanPokok == 0 || isNaN(dataKebutuhanPokok)) && (dataKeinginan == 0 || isNaN(dataKeinginan)) && (dataTabunganAtauInvestasi == 0 || isNaN(dataTabunganAtauInvestasi))) {
                alert('Harap diisi terlebih dahulu dan jangan ada karakter yang selain angka');
                //generateChart([0, 0, 0], [0, 0, 0]);
                return;
            }

            const dataInput = [dataKebutuhanPokok, dataKeinginan, dataTabunganAtauInvestasi];

            // sebagai data asli dari sistem
            const total = $('#realInputTotalAnggaranBulanan').val();
            const dataFromSystemKebutuhanPokok = total * 50 / 100;
            const dataFromSystemKeinginan = total * 30 / 100;
            const dataFromSystemTabunganAtauInvestasi = total * 20 / 100;
            const dataFromSystem = [dataFromSystemKebutuhanPokok, dataFromSystemKeinginan, dataFromSystemTabunganAtauInvestasi];
            generateChart(dataInput, dataFromSystem);


            const real = {
                kebutuhan: parseInt(dataKebutuhanPokok),
                keinginan: parseInt(dataKeinginan),
                tabungan: parseInt(dataTabunganAtauInvestasi)
            };
            const totalDataReal = real.kebutuhan + real.keinginan + real.tabungan;

            const ideal = {
                kebutuhan: dataFromSystemKebutuhanPokok,
                keinginan: dataFromSystemKeinginan,
                tabungan: dataFromSystemTabunganAtauInvestasi
            };
            let hasil = ['<ul class="list-disc ml-5 leading-[180%]">'];

            // cek jika pengeluaran melebihi total
            if (totalDataReal > total) {
                hasil.push(`<li>Total pengeluaran Anda (Rp${totalDataReal.toLocaleString()}) yang melebihi anggaran bulanan (Rp${total.toLocaleString()}).</li>`);
                hasil.push(`<li>Coba kurangi beberapa jenis pengeluaran agar tidak defisit (Jumlah yang rugi jika dibandingkan dengan total anggaran).</li>`);
            }

            // fungsi pembanding otomatis
            function cekSelisih(nama, realVal, idealVal) {
                const selisih = realVal - idealVal;
                if (Math.abs(selisih) < total * 0.05) {
                    hasil.push(`<li><strong>${nama}</strong> Anda sudah ideal.</li>`);
                } else if (selisih > 0) {
                    hasil.push(`<li><strong>${nama}</strong> melebihi batas ideal sebesar Rp${selisih.toLocaleString()}. Coba dikurangi sedikit.</li>`);
                } else {
                    hasil.push(`<li><strong>${nama}</strong> masih di bawah ideal sebesar Rp${Math.abs(selisih).toLocaleString()}, bisa ditambah sedikit.</li>`);
                }
            };

            for (const key in real) {
                const nama = key.charAt(0).toUpperCase() + key.slice(1);
                cekSelisih(nama, real[key], ideal[key]);
            }

            const semuaIdeal = Object.keys(real).every(k => Math.abs(real[k] - ideal[k]) < total * 0.05);
            if (semuaIdeal && totalDataReal <= total) {
                hasil.unshift("<p>ðŸŽ¯ Semua pengeluaran sudah ideal, pertahankan!</p>");
            }

            $('#chartOutput').removeClass('hidden').addClass('block');
            $('#parentHasil').removeClass('hidden').addClass('block')
            $('#hasil').html(hasil.join('') + '</ul>');
        }

        $(window).on('keypress', function (e) {
            if (e.which == 13) {
                const existingChart = Chart.getChart("chartOutput");
                if (existingChart) existingChart.destroy();
                // Sebagai data asli input
                const dataKebutuhanPokok = $('#realInputKebutuhanPokok').val();
                const dataKeinginan = $('#realInputKeinginan').val();
                const dataTabunganAtauInvestasi = $('#realInputTabunganAtauInvestasi').val();
                if ((dataKebutuhanPokok == 0 || isNaN(dataKebutuhanPokok)) && (dataKeinginan == 0 || isNaN(dataKeinginan)) && (dataTabunganAtauInvestasi == 0 || isNaN(dataTabunganAtauInvestasi))) {
                    alert('Harap diisi terlebih dahulu dan jangan ada karakter yang selain angka');
                    //generateChart([0, 0, 0], [0, 0, 0]);
                    return;
                }
                return perbandinganPengeluaran();
            }
        });

        $('#submit').on('click', function () {
            return perbandinganPengeluaran();
        })
    </script>
</body>

</html>